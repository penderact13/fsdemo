<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FriendSpaces</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ========================================
         AUTHENTICATION SCREEN
         ======================================== -->
    <div class="auth-screen" id="authScreen">
        <div class="logo-outer">
            <span class="logo" id="authLogo">üí¨</span>
        </div>
        <div class="auth-container">
            <h1>Welcome to FriendSpaces</h1>
            <p id="authDescription">Sign in to continue</p>
            <div class="error-message" id="authError"></div>
            
            <!-- Login Form -->
            <div id="loginForm">
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button class="btn" onclick="signIn()">Sign In</button>
                <button class="btn btn-secondary" onclick="showSignup()">Create Account</button>
            </div>

            <!-- Signup Form -->
            <div id="signupForm" class="hidden">
                <div class="input-group">
                    <label>Display Name</label>
                    <input type="text" id="signupName" placeholder="Your Name">
                </div>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="signupEmail" placeholder="your@email.com">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button class="btn" onclick="signUp()">Create Account</button>
                <button class="btn btn-secondary" onclick="showLogin()">Back to Sign In</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         KICKED MESSAGE MODAL
         ======================================== -->
    <div class="modal" id="kickedModal">
        <div class="modal-content">
            <h3>You were kicked from this space</h3>
            <p><strong>Reason:</strong></p>
            <div id="kickedReason" style="padding: 15px; background: #f5f5f5; border-radius: 8px; margin: 15px 0;"></div>
            <div class="wizard-buttons">
                <button class="btn" onclick="rejoinAfterKick()">Come Back</button>
                <button class="btn btn-secondary" onclick="logout()">Leave</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         MAIN APPLICATION
         ======================================== -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="space-icon" id="headerSpaceIcon">üåü</div>
                <div class="space-info">
                    <h2 id="headerSpaceName">Loading...</h2>
                    <p id="headerTableName">Main</p>
                </div>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div>
                        <div class="user-name" id="userName">User</div>
                        <div class="user-role-badge" id="userRoleBadge" style="display: none;"></div>
                    </div>
                </div>
                <button class="settings-btn" onclick="openSettings()" id="settingsBtn">‚öôÔ∏è Settings</button>
                <button class="settings-btn moderator-btn" onclick="openModerator()" id="moderatorBtn" style="display: none;">
                    üõ°Ô∏è Moderator
                    <span class="report-badge" id="reportBadge" style="display: none;">0</span>
                </button>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Sidebar with Tables -->
            <div class="sidebar">
                <h3>Tables</h3>
                <div id="tablesList"></div>
            </div>

            <!-- Chat Area -->
            <div class="chat-area">
                <div class="messages-container" id="messagesContainer">
                    <div class="loading">Loading messages...</div>
                </div>
                <div class="message-input-area" id="messageInputArea">
                    <div class="message-input-container">
                        <input type="text" id="messageInput" placeholder="Type a message..." onkeydown="handleMessageKeyDown(event)">
                        <button class="emoji-btn" onclick="toggleEmojiPicker()">üòä</button>
                        <button class="send-btn" onclick="sendMessage()">Send</button>
                    </div>
                    <div class="emoji-picker" id="emojiPicker" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            FriendSpaces is made by Mustafa Reza
        </div>
    </div>

    <!-- ========================================
         SETUP WIZARD
         ======================================== -->
    <div class="setup-wizard" id="setupWizard">
        <div class="wizard-container">
            <!-- Step 1: Space Name -->
            <div class="wizard-step active" id="step1">
                <h2>Name Your Space</h2>
                <p>Choose a name for your FriendSpace</p>
                <div class="input-group">
                    <label>Space Name</label>
                    <input type="text" id="spaceName" placeholder="My Awesome Space">
                </div>
                <div class="wizard-buttons">
                    <button class="btn" onclick="nextStep(2)">Next</button>
                </div>
            </div>

            <!-- Step 2: Space Icon -->
            <div class="wizard-step" id="step2">
                <h2>Choose an Icon</h2>
                <p>Enter any emoji or character from your keyboard</p>
                <div class="input-group">
                    <label>Emoji / Character</label>
                    <input type="text" id="emojiInput" maxlength="2" placeholder="Enter emoji (e.g., üéÆ)" style="font-size: 32px; text-align: center; padding: 20px;">
                </div>
                <div class="input-group">
                    <label>Or pick from suggestions:</label>
                    <div class="emoji-picker-setup" id="emojiPickerSetup"></div>
                </div>
                <div class="input-group">
                    <label>Background Color (choose a light color - text is black by default)</label>
                    <div class="color-picker" id="colorPicker"></div>
                </div>
                <div class="wizard-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(1)">Back</button>
                    <button class="btn" onclick="nextStep(3)">Next</button>
                </div>
            </div>

            <!-- Step 3: Tables -->
            <div class="wizard-step" id="step3">
                <h2>Create Tables</h2>
                <p>Tables are separate chats to organize your space. "Main" is already created.</p>
                <div class="table-list" id="tableSetupList">
                    <div class="table-input-item">
                        <input type="text" value="Main" disabled>
                        <span>üõ°Ô∏è</span>
                    </div>
                </div>
                <button class="add-table-btn" onclick="addTableToSetup()">+ Add Table</button>
                <div class="wizard-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(2)">Back</button>
                    <button class="btn" onclick="nextStep(4)">Next</button>
                </div>
            </div>

            <!-- Step 4: Public/Private -->
            <div class="wizard-step" id="step4">
                <h2>Space Privacy</h2>
                <p>Choose who can join your space</p>
                <div class="input-group">
                    <label>
                        <input type="radio" name="privacy" value="public" checked> Public - Anyone can join
                    </label>
                </div>
                <div class="input-group">
                    <label>
                        <input type="radio" name="privacy" value="private"> Private - Requires join code
                    </label>
                </div>
                <div class="wizard-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(3)">Back</button>
                    <button class="btn" onclick="nextStep(5)">Next</button>
                </div>
            </div>

            <!-- Step 5: Theme -->
            <div class="wizard-step" id="step5">
                <h2>Choose Theme</h2>
                <p>Customize your space appearance (or use defaults)</p>
                <div class="input-group">
                    <label>Background Color</label>
                    <input type="color" id="themeBg" value="#ecf0f1">
                </div>
                <div class="input-group">
                    <label>Text Color</label>
                    <input type="color" id="themeText" value="#2c3e50">
                </div>
                <div class="wizard-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(4)">Back</button>
                    <button class="btn" onclick="completeSetup()">Finish Setup</button>
                </div>
            </div>

            <!-- Step 6: Complete -->
            <div class="wizard-step" id="step6">
                <h2>üéâ All Set!</h2>
                <p>Your FriendSpace is ready. Share this with your friends!</p>
                <div class="code-display" id="joinCodeDisplay"></div>
                <div class="wizard-buttons">
                    <button class="btn" onclick="enterSpace()">Enter Space</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================
         JOIN CODE MODAL (for private spaces)
         ======================================== -->
    <div class="modal" id="joinCodeModal">
        <div class="modal-content">
            <h3>Private Space</h3>
            <p>This space requires a join code to access.</p>
            <div class="error-message" id="joinCodeError"></div>
            <div class="input-group">
                <label>Join Code</label>
                <input type="text" id="joinCodeInput" placeholder="Enter 10-character code">
            </div>
            <div class="wizard-buttons">
                <button class="btn btn-secondary" onclick="cancelJoinCode()">Cancel</button>
                <button class="btn" onclick="submitJoinCode()">Join</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         TABLE PERMISSIONS MODAL
         ======================================== -->
    <div class="modal" id="tablePermissionsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Manage Table: <span id="modalTableName"></span></h3>
                <button class="close-modal" onclick="closeTablePermissions()">√ó</button>
            </div>
            <div class="permission-section">
                <h4>Who can view this table?</h4>
                <div class="checkbox-group" id="canViewList"></div>
            </div>
            <div class="permission-section">
                <h4>Who can send messages?</h4>
                <div class="checkbox-group" id="canSitList"></div>
            </div>
            <div class="wizard-buttons">
                <button class="btn btn-secondary" onclick="closeTablePermissions()">Cancel</button>
                <button class="btn" onclick="saveTablePermissions()">Save</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         SETTINGS MODAL
         ======================================== -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Space Settings</h3>
                <button class="close-modal" onclick="closeSettings()">√ó</button>
            </div>

            <!-- Members Section -->
            <div class="settings-section">
                <h4>Members (<span id="memberCount">0</span>/50)</h4>
                <div class="member-list" id="membersList"></div>
            </div>

            <!-- Space Info Section -->
            <div class="settings-section">
                <h4>Space Information</h4>
                <p><strong>Space Name:</strong> <span id="settingsSpaceName"></span></p>
                <p><strong>Space Type:</strong> <span id="settingsSpaceType"></span></p>
                <p id="settingsJoinCodeContainer" class="hidden"><strong>Join Code:</strong> <span id="settingsJoinCodeValue"></span></p>
            </div>

            <!-- Account Section -->
            <div class="settings-section">
                <h4>Account</h4>
                <button class="btn btn-secondary btn-small" onclick="confirmDeleteAccount()">Delete Account</button>
            </div>

            <!-- Danger Zone (Owner Only) -->
            <div class="danger-zone" id="settingsDeleteBtn" style="display: none;">
                <h4>‚ö†Ô∏è Danger Zone</h4>
                <p>Deleting this space will permanently remove all messages, tables, and members. This cannot be undone!</p>
                <button class="btn btn-danger" onclick="deleteSpace()">Delete Space</button>
            </div>

            <div class="wizard-buttons mt-20">
                <button class="btn btn-secondary" onclick="closeSettings()">Close</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         MODERATOR MODAL
         ======================================== -->
    <div class="modal" id="moderatorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Moderator Panel</h3>
                <button class="close-modal" onclick="closeModerator()">√ó</button>
            </div>

            <div class="settings-section">
                <h4>Reported Messages</h4>
                <div id="reportedMessagesList"></div>
            </div>

            <div class="wizard-buttons mt-20">
                <button class="btn btn-secondary" onclick="closeModerator()">Close</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         REPORT CONFIRMATION MODAL
         ======================================== -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <h3>Report Message</h3>
            <p id="reportConfirmText"></p>
            <div class="wizard-buttons">
                <button class="btn btn-secondary" onclick="closeReportModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmReport()">Report</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         KICK MODAL
         ======================================== -->
    <div class="modal" id="kickModal">
        <div class="modal-content">
            <h3>Kick User</h3>
            <p>Why are you kicking <strong id="kickUserName"></strong>?</p>
            <div class="input-group">
                <label>Reason</label>
                <textarea id="kickReason" rows="3" placeholder="Enter reason for kick..."></textarea>
            </div>
            <div class="wizard-buttons">
                <button class="btn btn-secondary" onclick="closeKickModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmKick()">Kick User</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         BAN CONFIRMATION MODAL
         ======================================== -->
    <div class="modal" id="banModal">
        <div class="modal-content">
            <h3>Ban User</h3>
            <p>Are you sure you want to permanently ban <strong id="banUserName"></strong>?</p>
            <p style="color: #e74c3c; font-size: 14px;">This will prevent them from signing in to this space.</p>
            <div class="wizard-buttons">
                <button class="btn btn-secondary" onclick="closeBanModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmBan()">Ban User</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         FIREBASE SDKs
         ======================================== -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- ========================================
         APPLICATION SCRIPT
         ======================================== -->
    <script src="script.js"></script>
</body>
</html>
